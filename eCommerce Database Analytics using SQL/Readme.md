# Introduction

I've recently joined Maven Fuzzy Factory as an eCommerce Database Analyst, where I'm part of the startup team working closely with the CEO, Head of Marketing, and Website Manager. Our primary focus is to navigate the online retail space, analyze marketing channels, optimize website performance, and measure the impact of our new product launches.

# Data Information

Our database plays a pivotal role in our analysis and decision-making processes. It consists of six key tables:

1. **website_sessions**: This table holds essential information about website sessions, including details like session duration, user source, campaign, device type, and referral sources.

2. **website_pageviews**: Here, we store data related to website page views, tracking user activity across our web pages.

3. **products**: This table is dedicated to our product catalog, containing valuable data about our products, including their names and creation dates.

4. **orders**: We keep track of all customer orders in this table, capturing data on order IDs, website sessions, user IDs, primary products, items purchased, prices, and costs.

5. **order_items**: Each order can consist of multiple items, and this table stores the details of these items, such as product IDs, prices, and costs.

6. **order_item_refunds**: In case of any refunds, we meticulously record refund data here, including refund amounts and their associations with orders and items.

As we dive deeper into the data, my goal is to become the data expert for Maven Fuzzy Factory, providing mission-critical analyses that help drive our business forward and achieve our goals.

## Traffic Source Analysis

In the realm of eCommerce, understanding where your customers are coming from and which channels are driving the highest quality traffic is paramount. This analysis focuses on leveraging the UTM parameters stored in our database to identify paid website sessions and determine the revenue generated by these paid campaigns.

**1. Identifying Traffic Sources**

We commence by exploring the size of various traffic sources, primarily examining the UTM content that drives the most sessions within the specified dataset range.

```sql
SELECT utm_content,
       Count(DISTINCT website_session_id) AS sessions
FROM   website_sessions
WHERE  website_session_id BETWEEN 1000 AND 2000
GROUP  BY utm_content
ORDER  BY sessions DESC;
```

**Result:**

| utm_content | sessions |
|-------------|----------|
| g_ad_1      | 975      |
| null        | 18       |
| g_ad_2      | 6        |
| b_ad_2      | 2        |

In this context, 'g_ad_1' stands out as the dominant traffic source, driving 975 sessions. Null entries are also present, representing traffic without specific UTM content, totaling 18 sessions. Additionally, 'g_ad_2' and 'b_ad_2' contribute smaller session counts.

**2. Linking Traffic Sources to Orders**

Next, we expand our analysis to link these traffic sources to orders, gaining insights into how effectively these sources convert sessions into actual orders.

```sql
SELECT a.utm_content,
       Count(DISTINCT a.website_session_id) AS sessions,
       Count(DISTINCT b.order_id)           AS orders
FROM   website_sessions a
       LEFT JOIN orders b
              ON b.website_session_id = a.website_session_id
WHERE  a.website_session_id BETWEEN 1000 AND 2000
GROUP  BY a.utm_content
ORDER  BY sessions DESC;
```

**Result:**

| utm_content | sessions | orders |
|-------------|----------|--------|
| g_ad_1      | 975      | 35     |
| null        | 18       | 0      |
| g_ad_2      | 6        | 0      |
| b_ad_2      | 2        | 0      |

Unsurprisingly, 'g_ad_1' still leads in sessions with 975, contributing 35 orders. However, it's notable that 'null,' 'g_ad_2,' and 'b_ad_2' did not result in any orders during this period.

**3. Session-to-Order Conversion Rate**

To provide a comprehensive view, we calculate the session-to-order conversion rate for each traffic source.

```sql
SELECT a.utm_content,
       Count(DISTINCT a.website_session_id)    AS sessions,
       Count(DISTINCT b.order_id)              AS orders,
       Round(( Count(DISTINCT b.order_id) / Count(DISTINCT
             a.website_session_id) ) * 100, 2) AS sess_ord_conv_rate
FROM   website_sessions a
       LEFT JOIN orders b
              ON b.website_session_id = a.website_session_id
WHERE  a.website_session_id BETWEEN 1000 AND 2000
GROUP  BY a.utm_content
ORDER  BY sessions DESC;
```

**Result:**

| utm_content | sessions | orders | sess_ord_conv_rate |
|-------------|----------|--------|--------------------|
| g_ad_1      | 975      | 35     | 3.59               |
| null        | 18       | 0      | 0.00               |
| g_ad_2      | 6        | 0      | 0.00               |
| b_ad_2      | 2        | 0      | 0.00               |

When assessing the session-to-order conversion rates, 'g_ad_1' shows a rate of 3.59%. The other sources, including 'null,' 'g_ad_2,' and 'b_ad_2,' did not yield any conversions during this analyzed period.

In summary, this analysis provides insights into the effectiveness of various traffic sources in driving sessions and orders, with 'g_ad_1' being the most significant contributor to both sessions and orders. Understanding these conversion rates is crucial for optimizing our marketing strategies and improving the overall business performance.

**Analysis of Website Sessions â€“ UTM Source Breakdown**

**Request Explanation:**
Cindy, the date requested is April 12, 2012. The objective is to gain insights into the bulk of website sessions leading up to that date, specifically focusing on the breakdown by UTM source, campaign, and referring domain if available.

**SQL Query:**
```sql
select utm_content, utm_campaign, http_referer, count(DISTINCT website_session_id) as sessions
from website_sessions
where created_at < '2012-04-12'
GROUP BY utm_content, utm_campaign, http_referer
ORDER BY sessions DESC;
```

**SQL Query Explanation:**

1. `select utm_content, utm_campaign, http_referer, count(DISTINCT website_session_id) as sessions`: This part of the query selects the relevant columns from the `website_sessions` table, including UTM content, UTM campaign, HTTP referer, and calculates the count of distinct website session IDs, which represents the number of sessions.

2. `from website_sessions`: It specifies the source table from which the data is retrieved, which is the `website_sessions` table.

3. `where created_at < '2012-04-12'`: This clause filters the data based on the `created_at` column, ensuring that only records with a creation date before April 12, 2012, are included in the analysis.

4. `GROUP BY utm_content, utm_campaign, http_referer`: This clause groups the data by UTM content, UTM campaign, and HTTP referer, allowing for a breakdown of sessions by these parameters.

5. `ORDER BY sessions DESC`: The results are then ordered in descending order based on the number of sessions, with the most significant number of sessions appearing first in the output.

**Result:**

| utm_content | utm_campaign | http_referer            | sessions |
|-------------|--------------|-------------------------|----------|
| g_ad_1      | nonbrand     | https://www.gsearch.com | 3613     |
|             |              |                         | 28       |
|             |              | https://www.gsearch.com | 27       |
| g_ad_2      | brand        | https://www.gsearch.com | 26       |
|             | 7            | https://www.bsearch.com |          |
| b_ad_2      | brand        | https://www.bsearch.com | 7        |

**Interpretation:**

The provided data showcases a comprehensive breakdown of website sessions, sorted by UTM source, campaign, and referring domain. It's apparent that 'g_ad_1' nonbrand sessions from 'https://www.gsearch.com' dominate with 3613 sessions. Notably, there are several entries with null values for UTM content and campaign, which collectively contribute 28 sessions.

**Follow-up:**

As we observe the dominance of 'g_ad_1' nonbrand sessions, it is advisable to conduct a more detailed analysis of this particular source to identify optimization opportunities. To gain further insights and establish next steps, involving Tom for his expertise is a practical course of action.

**Request:**

Tom wants to determine the conversion rate (CVR) from website sessions to orders, specifically focusing on sessions generated through the "gsearch" source with a "nonbrand" campaign. The goal is to calculate whether the CVR meets the minimum threshold of 4% needed to make the financial numbers work. If the CVR is below this threshold, adjustments to reduce search bids might be necessary. Tom's request aims to evaluate the economic viability of their paid search campaigns.

**SQL Query:**
```sql
SELECT Count(DISTINCT a.website_session_id)    AS sessions,
       Count(DISTINCT b.order_id)              AS orders,
       Round(( Count(DISTINCT b.order_id) / Count(DISTINCT
             a.website_session_id) ) * 100, 2) AS CVR
FROM   website_sessions a
       LEFT JOIN orders b
              ON b.website_session_id = a.website_session_id
WHERE  a.created_at < '2012-04-14' 
       AND utm_source = "gsearch"
       AND utm_campaign = "nonbrand"
ORDER  BY 3 DESC; 
```

**SQL Query Explanation:**
- The query calculates the CVR by counting the number of distinct website sessions and orders.
- It computes the CVR by dividing the number of orders by the number of sessions and then multiplying by 100 to express it as a percentage.
- The query filters data based on the "gsearch" source and "nonbrand" campaign to focus on sessions from this specific marketing channel.
- Results are sorted in descending order based on the CVR.

**Answer:**
| # sessions | orders | CVR  |
|------------|--------|------|
| 3895       | 112    | 2.88 |

**Answer Interpretation:**
The analysis shows that the CVR for sessions generated through the "gsearch" source with a "nonbrand" campaign is approximately 2.88%. This CVR falls short of the 4% threshold needed to make the economics work for the paid search campaigns. Consequently, there is a need to reduce search bids since the current conversion rate indicates that they are over-spending.

**Comment by Tom:**
Tom acknowledges the analysis and mentions that, based on the findings, they need to dial down their search bids. The reason for this is that they are currently over-spending on their campaigns due to the lower-than-desired conversion rate. The analysis has helped them make more cost-effective decisions and saved them money.

**Request:**
The request is to analyze traffic sources and bid optimization based on website sessions and orders data. The goal is to understand the value of different segments of paid traffic for bid optimization.

**Query 1: Trended Sessions**
This query calculates the trended sessions by year and week. It focuses on sessions falling within the specified `website_session_id` range. The results include the year, week, the start date of the week, and the number of sessions for each week.

```sql
select year(created_at), week(created_at),
min(date(created_at)) as week_start,
count(DISTINCT website_session_id) as sessions
from website_sessions
where website_session_id BETWEEN 100000 AND 115000
GROUP BY 1,2;
```

**Explanation 1:**
The query extracts trended sessions, which are useful for understanding website traffic patterns over time. It filters sessions within the defined `website_session_id` range and groups them by year and week. The results show the number of sessions for each week, helping identify trends.

**Answer 1:**
The first answer provides trended sessions data, including the year, week, week start date, and the number of sessions for each week within the specified `website_session_id` range.

**Query 2: Pivot Table in SQL using Orders Data**
This query constructs a pivot table to analyze primary product categories' performance in terms of single-item and two-item orders. It counts the number of single-item and two-item orders for each primary product category within the specified `order_id` range.

```sql
select primary_product_id,
count(DISTINCT case when items_purchased = 1 then order_id else null end) as count_single_item_orders,
count(DISTINCT case when items_purchased = 2 then order_id else null end) as count_two_item_orders
from orders 
where order_id between 31000 AND 32000
GROUP BY 1;
```

**Explanation 2:**
This query creates a pivot table to show how different primary product categories perform in terms of order types. It categorizes orders as single-item or two-item orders and counts them for each primary product category within the specified `order_id` range. This analysis helps understand how products perform with different order types.

**Answer 2:**
The second answer offers a pivot table displaying the count of single-item and two-item orders for each primary product category in the specified `order_id` range.

**Request (May 10, 2012):**
The request is to analyze the trended session volume for the "gsearch nonbrand" traffic source by week. This analysis aims to determine if the bid changes made on 2012-04-15 have affected the volume of sessions for this traffic source.

**Query:**
This SQL query retrieves the week's starting date and the number of distinct website sessions for the "gsearch nonbrand" traffic source. It filters the data based on the created date and specific UTM source and campaign conditions.

```sql
SELECT Min(Date(created_at))              AS week_start,
       Count(DISTINCT website_session_id) AS sessions
FROM   website_sessions
WHERE  created_at < '2012-05-10'
       AND utm_source = "gsearch"
       AND utm_campaign = "nonbrand"
GROUP  BY Yearweek(created_at); 
```

**Explanation:**
The query extracts data on the number of website sessions for "gsearch nonbrand" by weeks. It calculates the starting date of each week and counts the sessions within the specified date range. The data is grouped by the year and week of the created date.

**Answer:**

| # week_start | sessions |
|--------------|----------|
| 2012-03-19   | 896      |
| 2012-03-25   | 956      |
| 2012-04-01   | 1152     |
| 2012-04-08   | 983      |
| 2012-04-15   | 621      |
| 2012-04-22   | 594      |
| 2012-04-29   | 681      |
| 2012-05-06   | 399      |

The answer table presents the week's starting date and the corresponding number of sessions for "gsearch nonbrand." This data allows for the assessment of changes in session volume over time, particularly concerning the bid adjustments.

**Comment by the Requester (Tom - May 10, 2012):**
The requester acknowledges the analysis and expresses that it appears that bid changes have a significant impact on the sensitivity of "gsearch nonbrand" traffic. While the goal is to maximize volume, it's crucial not to overspend on ads, and they plan to contemplate potential strategies based on this insight.

**Request (May 11, 2012):**
The request is to calculate conversion rates from website session to order, categorized by device type (desktop and mobile). This analysis aims to compare the performance of desktop and mobile devices. The goal is to identify whether desktop performance is superior to mobile performance, as this insight could inform bid adjustments for desktop to potentially increase sales volume.

**Query:**
This SQL query retrieves data related to website sessions and orders. It calculates the number of sessions, orders, and the conversion rate (CVR) for each device type. The data is filtered based on various conditions, including the created date and specific UTM source and campaign criteria.

```sql
SELECT a.device_type,
       Count(DISTINCT a.website_session_id)    AS sessions,
       Count(DISTINCT b.order_id)              AS orders,
       Round(( Count(DISTINCT b.order_id) / Count(DISTINCT a.website_session_id) ) * 100, 2) AS CVR
FROM   website_sessions a
       LEFT JOIN orders b
              ON b.website_session_id = a.website_session_id
WHERE  a.created_at < '2012-05-11' 
       AND utm_source = "gsearch"
       AND utm_campaign = "nonbrand"
GROUP BY 1
ORDER  BY 3 DESC; 
```

**Explanation:**
The query fetches data related to the number of website sessions and orders, and it calculates the conversion rate (CVR) for both desktop and mobile devices. It joins data from the "website_sessions" and "orders" tables based on the website session ID. The data is filtered by specific conditions, including the created date, UTM source, and campaign criteria. The result is grouped by device type and sorted by the order count in descending order.

**Answer:**

| # device_type | sessions | orders | CVR  |
|---------------|----------|--------|------|
| desktop       | 3911     | 146    | 3.73 |
| mobile        | 2492     | 24     | 0.96 |

The answer table presents the device types (desktop and mobile), along with the number of sessions, orders, and the corresponding conversion rates (CVR). This data provides insights into the performance of each device type, with desktop showing a significantly higher CVR compared to mobile.

**Comment by the Requester (Tom - May 11, 2012):**
The requester acknowledges the results and confirms their decision to increase bids specifically for desktop devices. By bidding higher, they aim to improve their ranking in auctions, which, based on the provided insights, is expected to boost sales. The requester praises the analysis and expresses gratitude for the insights.

**Request (June 09, 2012):**
In this request, the requester asks for an analysis of weekly trends for both desktop and mobile devices following recent bid changes for "gsearch nonbrand" campaigns. The analysis aims to understand the impact on website session volumes for desktop and mobile devices after the bid changes. The specified date range for the analysis is from April 15, 2012, to June 9, 2012. This period is considered the baseline for comparison.

**Query:**
This SQL query is designed to retrieve data related to website sessions. It calculates the count of sessions for both desktop and mobile devices and categorizes them by week. The data is filtered based on specific conditions, including the created date and UTM source and campaign criteria.

```sql
SELECT 
min(date(created_at)) as week_start,
Count(DISTINCT case when device_type = "desktop" then website_session_id else null end) AS dtop_sessions,
Count(DISTINCT case when device_type = "mobile" then website_session_id else null end) AS mob_sessions
FROM   website_sessions 
WHERE  created_at >= '2012-04-15' AND created_at < '2012-06-9' 
and utm_source = "gsearch"
and utm_campaign = "nonbrand"
GROUP BY yearweek(created_at);
```

**Explanation:**
The query retrieves website session data for both desktop and mobile devices, categorizing sessions by week. It uses conditional statements to count sessions specifically for each device type. The data is filtered based on specific date ranges, UTM source, and campaign criteria, allowing the comparison of trends for desktop and mobile devices.

**Answer:**
| # week_start | dtop_sessions | mob_sessions |
|--------------|---------------|--------------|
| 2012-04-15   | 383           | 238          |
| 2012-04-22   | 360           | 234          |
| 2012-04-29   | 425           | 256          |
| 2012-05-06   | 430           | 282          |
| 2012-05-13   | 403           | 214          |
| 2012-05-20   | 661           | 190          |
| 2012-05-27   | 585           | 183          |
| 2012-06-03   | 582           | 157          |

The answer table presents the week start date, along with the number of sessions for desktop and mobile devices in each corresponding week. The data shows how session volumes have changed during the specified period, following the bid changes. This information provides insights into the impact of bid adjustments on website session volumes for different devices.

**Extra Analysis:**
An additional SQL query is provided, showing the device type, week start date, session count, order count, and conversion rate (CVR) for both desktop and mobile devices during the same date range. This extra analysis allows for a more detailed understanding of the performance of each device type.
```sql
SELECT a.device_type,
min(date(a.created_at)) as week_start,
Count(DISTINCT a.website_session_id)    AS sessions,
       Count(DISTINCT b.order_id)              AS orders,
       Round(( Count(DISTINCT b.order_id) / Count(DISTINCT
             a.website_session_id) ) * 100, 2) AS CVR
FROM   website_sessions a
       LEFT JOIN orders b
              ON b.website_session_id = a.website_session_id
WHERE  a.created_at>='2012-04-15' AND a.created_at < '2012-06-9' 
and utm_source = "gsearch"
and utm_campaign = "nonbrand"
GROUP BY 1, yearweek(a.created_at);
```
**ANSWER:**
| # device_type | week_start | sessions | orders | CVR  |
|---------------|------------|----------|--------|------|
| desktop       | 2012-04-15 | 383      | 11     | 2.87 |
| desktop       | 2012-04-22 | 360      | 13     | 3.61 |
| desktop       | 2012-04-29 | 425      | 12     | 2.82 |
| desktop       | 2012-05-06 | 430      | 14     | 3.26 |
| desktop       | 2012-05-13 | 403      | 15     | 3.72 |
| desktop       | 2012-05-20 | 661      | 25     | 3.78 |
| desktop       | 2012-05-27 | 585      | 27     | 4.62 |
| desktop       | 2012-06-03 | 582      | 25     | 4.30 |
| mobile        | 2012-04-15 | 238      | 6      | 2.52 |
| mobile        | 2012-04-22 | 234      | 1      | 0.43 |
| mobile        | 2012-04-29 | 256      | 2      | 0.78 |
| mobile        | 2012-05-06 | 282      | 1      | 0.35 |
| mobile        | 2012-05-13 | 214      | 3      | 1.40 |
| mobile        | 2012-05-20 | 190      | 0      | 0.00 |
| mobile        | 2012-05-27 | 183      | 2      | 1.09 |
| mobile        | 2012-06-03 | 157      | 2      | 1.27 |

**Comment by the Requester (Tom - June 09, 2012):**
The requester acknowledges the analysis results and expresses satisfaction with the insights. They note that the mobile performance appears to have been relatively flat or slightly declining, while desktop performance has improved due to the bid changes made based on the previous conversion rate analysis. The requester appreciates the positive direction in which things are moving.

